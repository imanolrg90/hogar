{% extends "base.html" %}
{% block title %}Ejercicios{% endblock %}
{% block content %}
<div class="header-section">
    <h1>Ejercicios</h1>
    <p style="color: var(--text-muted);">Gestiona tu catálogo.</p>
</div>

<div class="bento-grid">
    <div class="bento-card" style="grid-column: 1 / -1; min-height: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 10px;">
            <div class="widget-title" style="margin: 0;">Catálogo</div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button onclick="openNewModal()" class="action-key dark" style="width: auto; padding: 8px 20px; font-size: 0.9rem;">
                    <i class="fas fa-plus"></i> Nuevo
                </button>
            </div>
        </div>

        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; font-size: 0.95rem;">
                <thead>
                    <tr style="text-align: left; border-bottom: 2px solid #F3F4F6; color: var(--text-muted);">
                        <th style="padding: 12px;">Nombre</th>
                        <th style="padding: 12px;">Músculo</th>
                        <th style="padding: 12px; text-align: right;">Acciones</th>
                    </tr>
                </thead>
                <tbody id="exercisesTableBody">
                    {% for ex in exercises %}
                    <tr style="border-bottom: 1px solid #F9FAFB;">
                        <td style="padding: 12px; font-weight: 600;">{{ ex.name }}</td>
                        <td style="padding: 12px;">{{ ex.muscle_group }}</td>
                        <td style="padding: 12px; text-align: right; white-space: nowrap;">
                            <a href="{{ url_for('gym_progress', exercise_id=ex.id) }}" title="Ver Progreso"
                               style="color: var(--primary); margin-right: 10px; text-decoration: none;">
                                <i class="fas fa-chart-line"></i>
                            </a>
                            <button onclick="openEditModal('{{ ex.id }}', '{{ ex.name }}', '{{ ex.muscle_group }}', `{{ ex.description or '' }}`, '{{ ex.video_link or '' }}')"
                                    title="Editar" style="border:none; background:none; cursor:pointer; color:#F59E0B; margin-right: 10px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <a href="{{ url_for('delete_exercise', id=ex.id) }}" 
                               onclick="return confirm('¿Seguro que quieres borrar este ejercicio?')"
                               title="Borrar" style="color: #EF4444; text-decoration: none;">
                                <i class="fas fa-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div id="exerciseModal" class="modal-overlay">
    <div class="modal-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 id="modalTitle" style="margin: 0; font-size: 1.25rem;">Nuevo Ejercicio</h2>
            <button onclick="closeModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>

        <form method="POST" id="exerciseForm">
            {{ form.hidden_tag() }}
            <div style="margin-bottom: 15px;">
                <label>Nombre</label>
                {{ form.name(class="form-control", id="inputName", style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;") }}
            </div>
            <div style="margin-bottom: 25px;">
                <label>Músculo</label>
                {{ form.muscle_group(class="form-control", id="inputMuscle", style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;") }}
            </div>
            <div style="margin-bottom: 15px;">
    <label>Descripción / Técnica</label>
    {{ form.description(class="form-control", id="inputDesc", rows="3", style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit;") }}
</div>

<div style="margin-bottom: 25px;">
    <label>Link Youtube</label>
    {{ form.video_link(class="form-control", id="inputLink", placeholder="https://youtube.com/...", style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;") }}
</div>
            
            <button type="submit" class="action-key dark">Guardar</button>
        </form>
    </div>
</div>

<style>
    /* ... (Mismo CSS de modal que tenías) ... */
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .modal-content { background: white; padding: 25px; border-radius: 16px; width: 90%; max-width: 400px; }
</style>

<script>
   function openNewModal() {
        document.getElementById('modalTitle').innerText = 'Nuevo Ejercicio';
        document.getElementById('exerciseForm').action = "{{ url_for('gym_exercises') }}";
        document.getElementById('inputName').value = '';
        document.getElementById('inputDesc').value = ''; // Limpiar
        document.getElementById('inputLink').value = ''; // Limpiar
        document.getElementById('exerciseModal').style.display = 'flex';
    }

    function openEditModal(id, name, muscle, desc, link) {
        document.getElementById('modalTitle').innerText = 'Editar Ejercicio';
        document.getElementById('exerciseForm').action = "/gym/exercises/edit/" + id;
        document.getElementById('inputName').value = name;
        document.getElementById('inputMuscle').value = muscle;
        document.getElementById('inputDesc').value = desc; // Cargar
        document.getElementById('inputLink').value = link; // Cargar
        document.getElementById('exerciseModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('exerciseModal').style.display = 'none';
    }
</script>
{% endblock %}