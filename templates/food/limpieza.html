{% extends "base.html" %}

{% block title %}Men√∫ Semanal{% endblock %}

{% block content %}
    <h1>üìÖ Men√∫ Semanal</h1>
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <p>Selecciona tus recetas o usa el bot√≥n para generar uno nuevo. Pulsa 'Guardar Cambios' para actualizar la lista de compra.</p>
        <a href="{{ url_for('menu_semanal_page') }}" class="btn btn-secondary"><i class="fas fa-redo"></i> Regenerar Men√∫</a>
    </div>

    {# FORMULARIO DEL MEN√ö: El POST aqu√≠ dispara la l√≥gica de edici√≥n en app.py #}
    <form method="POST" class="card">
        <h2>Men√∫ de la Semana (Editable)</h2>
        <table class="menu-table">
            <thead>
                <tr>
                    <th>D√≠a</th>
                    <th>Comida (<i class="fas fa-fire"></i> Kcal)</th>
                    <th>Cena (<i class="fas fa-fire"></i> Kcal)</th>
                </tr>
            </thead>
            <tbody>
                {% for dia_menu in menu %}
                    <tr>
                        <td class="day-header">{{ dia_menu.dia }}</td>
                        <td>
                            {# Desplegable para Comida #}
                            <select name="{{ dia_menu.dia }}_comida" class="menu-select">
                                {% for receta in recetas %}
                                    <option value="{{ receta.id }}" 
                                            {% if receta.id == dia_menu.comida.id %}selected{% endif %}>
                                        {{ receta.nombre }} ({{ receta.kcal|int }} Kcal)
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            {# Desplegable para Cena #}
                            <select name="{{ dia_menu.dia }}_cena" class="menu-select">
                                {% for receta in recetas %}
                                    <option value="{{ receta.id }}" 
                                            {% if receta.id == dia_menu.cena.id %}selected{% endif %}>
                                        {{ receta.nombre }} ({{ receta.kcal|int }} Kcal)
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {# BOT√ìN CRUCIAL DE SUBMIT #}
        <button type="submit" class="btn btn-primary" style="margin-top: 20px;"><i class="fas fa-save"></i> Guardar Cambios y Recalcular Lista</button>
    </form>
    
    {# LISTA DE COMPRA #}
    <div class="card">
        <h2>üõí Lista de Compra Consolidada</h2>
        <p>Total consolidado de ingredientes para todo el men√∫ semanal.</p>
        <table class="shopping-list">
            <thead>
                <tr>
                    <th>Ingrediente</th>
                    <th>Cantidad Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in lista_compra %}
                    <tr>
                        <td>{{ item.nombre }}</td>
                        <td><span class="quantity">{{ item.cantidad|round(1) }}{% if item.cantidad %}{% endif %}</span> {{ item.unidad }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}